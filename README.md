![example event parameter](https://github.com/Motion-Up/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg?event=push)

# Ссылка на проект
Ссылка на проект http://45.133.203.163
# Проект YaMDb
 Проект YaMDb собирает отзывы пользователей на произведения. Произведения делятся на категории: «Книги», «Фильмы», «Музыка». Список категорий  может быть расширен администратором.
 Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.
 Произведению может быть присвоен жанр из списка предустановленных. Новые жанры может создавать только администратор.
 Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). На одно произведение пользователь может оставить только один отзыв.

## Техническое описание проекта YaMDb

К проекту по адресу http://127.0.0.1:8000/redoc/ подключена документация API YaMDb. В ней описаны возможные запросы к API и структура ожидаемых ответов. Для каждого запроса указаны уровни прав доступа: пользовательские роли, которым разрешён запрос.

## Cтек технологий

- проект написан на Python с использованием веб-фреймворка Django REST Framework.
- библиотека Simple JWT - работа с JWT-токеном
- библиотека django-filter - фильтрация запросов
- база данных - PostgreSQL
- автоматическое развертывание проекта - Docker, docker-compose
- настроено CI и CD для проекта (реализован автоматический запуск тестов, обновление образов на Docker Hub, втоматический деплой на боевой сервер при пуше в главную ветку main)  
- система управления версиями - git

## Как запустить проект, используя Docker (база данных PostgreSQl):
Клонировать репозиторий и перейти в него в командной строке:
```bash
    git clone https://github.com/Evgenia789/yamdb_final
```
В дериктории проекта создайте файл .env, в котором пропишите следующие переменные окружения (для тестирования можете использовать указанные значения переменных):

- DB_ENGINE=django.db.backends.postgresql
- DB_NAME=postgres
- POSTGRES_USER=Admin
- POSTGRES_PASSWORD=654qwe345
- DB_HOST=127.0.0.1
- DB_PORT=5432

С помощью Dockerfile и docker-compose.yaml разверните проект:
```bash
    docker-compose up --build
```
В новом окне терминала узнайте id контейнера yamdb_web и войдите в контейнер:
```bash
    docker container ls
```
```bash
    docker exec -it <CONTAINER_ID> bash
```
В контейнере выполните миграции, создайте суперпользователя и заполните базу начальными данными:
```bash
    docker-compose exec web python manage.py migrate
    docker-compose exec web python manage.py createsuperuser
    docker-compose exec web python manage.py collectstatic --no-input
```
____
Ваш проект запустился на http://127.0.0.1:8000/  
Полная документация (redoc.yaml) доступна по адресу http://127.0.0.1:8000/redoc/  
C помощью команды pytest вы можете запустить тесты и проверить работу модулей 
```bash
    docker exec -ti <CONTAINER_ID> pytest
```

## Алгоритм регистрации новых пользователей

1. Пользователь отправляет POST-запрос с параметрами email и username на эндпоинт /api/v1/auth/signup/.
2. Сервис YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на указанный адрес email.
3. Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен).

В результате пользователь получает токен и может работать с API проекта, отправляя этот токен с каждым запросом.
После регистрации и получения токена пользователь может отправить PATCH-запрос на эндпоинт /api/v1/users/me/ и заполнить поля в своём профайле (описание полей — в документации).

## Ресурсы API YaMDb
- Ресурс auth: аутентификация.
- Ресурс users: пользователи.
- Ресурс titles: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
- Ресурс categories: категории (типы) произведений («Фильмы», «Книги», «Музыка»).
- Ресурс genres: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- Ресурс reviews: отзывы на произведения. Отзыв привязан к определённому произведению.
- Ресурс comments: комментарии к отзывам. Комментарий привязан к определённому отзыву.

## Пример http-запроса (POST) 
```
    url = 'http://127.0.0.1:8000/api/v1/titles/  
    data = {"name": "string", "year": 0, "description": "string", "genre": ["string"], "category": "string"}  
    headers = {'Authorization': 'Bearer your_token'}  
    request = request.post(url, data=data, headers=headers)  
```
## Ответ API_YaMDb:
```
Статус - код 200
{
"id": 0,
"name": "string",
"year": 0,
"rating": 0,
"description": "string",
"genre": [
{}
],
"category": {
"name": "string",
"slug": "string"
}
}
```